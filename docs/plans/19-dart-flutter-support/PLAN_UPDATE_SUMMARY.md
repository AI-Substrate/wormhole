# Dart/Flutter Plan Update Summary

## Changes Made Based on User Feedback (2025-10-20)

### 1. Testing Approach Changed: TAD → Manual Extension Host Testing

**Old Approach**: TAD (Test-Assisted Development) with scratch→promote workflow
**New Approach**: Get implementation in, then test manually in Extension Host

**Rationale**: Integration testing up front is too complex for initial Dart support. Focus on:
1. Getting the code in place
2. Creating integration test structure (shows the gap)
3. Testing manually in Extension Host
4. Later: Build out full integration tests once DAP is working

**Impact**:
- Phase 0: Create `test/integration-simple/dart/` structure  (demonstrates gap)
- Phase 1-4: Implementation without test-first constraints
- Phase 6: Manual validation acceptable

### 2. New Phase 0: Integration Test Structure Setup

**Objective**: Create Dart test structure in `test/integration-simple/dart/` that matches other languages (Python, C#, Java, TypeScript)

**Expected Behavior**: Tests will FAIL until DartDebugAdapter is implemented

**Files to Create**:
```
test/integration-simple/dart/
├── .vscode/settings.json          # Disable Dart test runner
├── pubspec.yaml                   # package:test dependency
├── pubspec.lock                   # Generated by dart pub get
└── test/debug_test.dart           # VSCB_BREAKPOINT markers
```

**Integration**:
- Add `test/integration/workflows/dart-workflow.ts` (enhanced coverage config)
- Update `test/integration/unified-debug.test.ts` (include Dart test suite)
- Test will fail with clear error: "No debug adapter found for type 'dart'"

**Success Criteria**:
- Files created and committed
- `dart pub get` succeeds
- `dart test` runs successfully
- Integration test fails with expected error (missing adapter)
- Failure mode documented

### 3. Path Inconsistencies Fixed

**Changes**:
| Old Path | New Path | Reason |
|----------|----------|--------|
| `tests/scratch/` | `scratch/dart-adapter/` | Project convention: scratch at root |
| `tests/unit/` | `test/unit/` | Project uses `test/` not `tests/` |
| `tests/integration/` | `test/integration/` | Project uses `test/` not `tests/` |
| Relative paths in links | Absolute paths | Plan validation requirement |

**Files Updated**:
- All task success criteria now use absolute paths
- All code examples use correct directory structure
- All documentation references use absolute paths

### 4. Success Criteria Made Measurable

**Example Fixes**:

| Phase | Task | Old Criteria (Vague) | New Criteria (Measurable) |
|-------|------|---------------------|--------------------------|
| 0 | 0.1 | "excluded from CI" | `grep -q "scratch/" .gitignore && echo "✓ scratch/ excluded"` |
| 0 | 0.4 | "Dart SDK 3.x installed" | `docker exec <container> dart --version \| grep "Dart SDK version: 3\\."` |
| 0 | 0.6 | "extension provides syntax highlighting" | `code --list-extensions \| grep -q "Dart-Code.dart-code"` |
| 1 | 1.15 | "coverage >80%" | `npm run test:coverage -- --testPathPattern=dart-adapter && lcov --summary coverage/lcov.info` |
| 2 | 2.7 | ">10% flake rate" | `for i in {1..10}; do vscb script run tests.debug-single ...; done && echo "Flake rate: $failures/10"` |
| 4 | 4.14 | "No flakiness" | `for i in {1..3}; do npm test -- unified-debug.test.ts --testNamePattern="Dart"; done` |

### 5. Phase 6 Kept Manual

**Acceptance**: Manual validation is acceptable for Phase 6
- AC #1-9, #13: Manual testing with checklist
- AC #10: Automated (`just test-integration`)
- AC #11-12: Manual validation

**Documentation**: Each manual test has exact steps to follow

### 6. Validation Issues Addressed

**HIGH Severity (13 total)** - All Fixed:
- ✅ Relative paths → Absolute paths
- ✅ TAD workflow violations → Removed TAD
- ✅ Vague success criteria → Exact commands
- ✅ Phase 6 manual tests → Documented as acceptable

**MEDIUM Severity (9 total)** - All Fixed:
- ✅ Scratch directory location → `scratch/dart-adapter/`
- ✅ Test directory naming → `test/` not `tests/`
- ✅ Research references → Absolute paths with sections

**LOW Severity (5 total)** - All Fixed:
- ✅ Capitalization of "the research" → Standardized lowercase
- ✅ Documentation paths → Absolute paths

## Updated Phase Structure

### Phase 0: Integration Test Structure (NEW)
**Goal**: Create test/integration-simple/dart/ with expected failure
**Duration**: 1-2 hours
**Deliverables**:
- Dart test project structure matching other languages
- Integration test workflow file
- Documented failure mode (missing adapter)

### Phase 1: DartDebugAdapter Implementation
**Goal**: Core adapter with Dart-specific features
**Duration**: 2-3 days
**Deliverables**:
- DartDebugAdapter class
- Isolate management
- Variable traversal
- Dart-specific features (getters, Maps, Records)

### Phase 2: Test Discovery & Integration
**Goal**: Dart test pattern detection
**Duration**: 1 day
**Deliverables**:
- isDartTestSession() function
- Test pattern detection
- waitForTestDebugSession() integration

### Phase 3: Test Projects Setup
**Goal**: Main test project (not integration-simple, that's Phase 0)
**Duration**: 4 hours
**Deliverables**:
- test/dart/ project
- Launch configurations
- Sample Dart code

### Phase 4: Integration Test Validation
**Goal**: Verify integration tests now pass
**Duration**: 1 day
**Deliverables**:
- dart-workflow.ts configured correctly
- `just test-integration` includes and passes Dart tests
- Both CLI and MCP runners work

### Phase 5: Documentation
**Goal**: User-facing documentation
**Duration**: 1 day
**Deliverables**:
- README update
- docs/how/dart-flutter-debugging/ guides

### Phase 6: Manual Validation
**Goal**: Validate all 13 acceptance criteria
**Duration**: 1-2 days
**Deliverables**:
- Manual test checklist completed
- Edge cases validated
- Performance verified

## Key Decisions

1. **Testing Strategy**: Get it in → Manual test → Build integration tests later
2. **Phase 0 Purpose**: Show the gap before implementation (failing test)
3. **Success Criteria**: All now have exact commands or clear manual steps
4. **Paths**: All absolute, all using correct directories
5. **Validation**: Manual acceptable for Phase 6, automated for Phase 4

## Next Steps

1. ✅ Update plan document with all fixes
2. ⏭️ Run `/plan-4-complete-the-plan` to re-validate
3. ⏭️ Run `/plan-5-phase-tasks-and-brief --phase 0` to begin Phase 0
